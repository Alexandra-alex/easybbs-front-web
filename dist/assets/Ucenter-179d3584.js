import{A as G}from"./ArticleListItem-83b88a0c.js";import{q as E,s as A,G as $,r as M,x as i,a as l,o as I,c as O,w as n,b as o,m as V,t as u,u as Y,N as j,k as e,L as Q,y as W,Q as L,j as x,n as S,v as K}from"./.pnpm-d8f10c30.js";import"./_plugin-vue_export-helper-c27b6911.js";const X={__name:"UcenterEditUserInfo",emits:["resetUserInfo"],setup(q,{expose:w,emit:C}){const{proxy:b}=E(),d=A();$();const _={updateUserInfo:"/userCenter/updateUserInfo"},c=M({show:!1,title:"编辑个人信息",buttons:[{type:"primary",text:"确定",click:r=>{f()}}]}),a=i({}),p=i(),f=()=>{p.value.validate(async r=>{if(!r)return;let t={};Object.assign(t,a.value),await b.Request({url:_.updateUserInfo,params:t})&&(c.show=!1,t.avatar instanceof File?d.go(0):C("resetUserInfo",t))})};return w({showEditUserInfoDialog:r=>{c.show=!0,j(()=>{p.value.resetFields();const t=JSON.parse(JSON.stringify(r));t.avatar={imageUrl:t.userId},a.value=t})}}),(r,t)=>{const m=l("el-form-item"),g=l("CoverUpload"),U=l("el-radio"),R=l("el-radio-group"),D=l("el-input"),v=l("el-form"),T=l("Dialog");return I(),O(T,{show:c.show,title:c.title,buttons:c.buttons,width:"450px",showCancel:!1,onClose:t[3]||(t[3]=h=>c.show=!1)},{default:n(()=>[o(v,{model:a.value,ref_key:"formDataRef",ref:p,"label-width":"40px"},{default:n(()=>[o(m,{label:"昵称",prop:"nickeName"},{default:n(()=>[V(u(a.value.nickName),1)]),_:1}),o(m,{label:"头像",prop:"avatar"},{default:n(()=>[o(g,{imageUlrPrefix:Y(b).globalInfo.avatarUrl,modelValue:a.value.avatar,"onUpdate:modelValue":t[0]||(t[0]=h=>a.value.avatar=h)},null,8,["imageUlrPrefix","modelValue"])]),_:1}),o(m,{label:"性别",prop:"sex"},{default:n(()=>[o(R,{modelValue:a.value.sex,"onUpdate:modelValue":t[1]||(t[1]=h=>a.value.sex=h)},{default:n(()=>[o(U,{label:0},{default:n(()=>[V("女")]),_:1}),o(U,{label:1},{default:n(()=>[V("男")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"",prop:""},{default:n(()=>[o(D,{clearable:"",placeholder:"请输入简介",type:"textarea",rows:5,maxlength:100,resize:"none","show-word-limit":"",modelValue:a.value.personDescription,"onUpdate:modelValue":t[2]||(t[2]=h=>a.value.personDescription=h)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])}}};const Z=e("div",{class:"data-item"},[e("div",{class:"record-type"},"类型"),e("div",{class:"integral"},"积分"),e("div",{class:"create-time"},"时间")],-1),ee={class:"data-item"},te={class:"record-type"},ae={class:"create-time"},oe={__name:"UserIntegralRecord",setup(q,{expose:w}){const{proxy:C}=E();A(),$();const b={loadUserIntegralRecord:"/userCenter/loadUserIntegralRecord"},d=M({show:!1,title:"查看用户积分记录",buttons:[{type:"primary",text:"确定",click:r=>{d.show=!1}}]}),_=i({}),c=i();w({showRecord:()=>{d.show=!0,j(()=>{c.value.resetFields(),y()})}});const p=i(!1),f=i({}),y=async()=>{p.value=!0;let r={pageNo:f.value.pageNo};_.value.createTimeRange&&(r.createTimeStart=_.value.createTimeRange[0],r.createTimeEnd=_.value.createTimeRange[1]);let t=await C.Request({url:b.loadUserIntegralRecord,params:r,showLoading:!1});p.value=!1,t&&(f.value=t.data)};return(r,t)=>{const m=l("el-date-picker"),g=l("el-form-item"),U=l("el-form"),R=l("DataList"),D=l("Dialog");return I(),O(D,{show:d.show,title:d.title,buttons:d.buttons,width:"600px",showCancel:!1,onClose:t[1]||(t[1]=v=>d.show=!1)},{default:n(()=>[o(U,{model:_.value,ref_key:"formDataRef",ref:c,"label-width":"40px"},{default:n(()=>[o(g,{label:"日期",prop:"createTimeRange"},{default:n(()=>[o(m,{modelValue:_.value.createTimeRange,"onUpdate:modelValue":t[0]||(t[0]=v=>_.value.createTimeRange=v),type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",onChange:y},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),Z,o(R,{loading:p.value,dataSource:f.value,onLoadData:y,noDataMsg:"暂无相关记录"},{default:n(({data:v})=>[e("div",ee,[e("div",te,u(v.operTypeName),1),e("div",{class:Q(["integral",v.integral>0?"add":"reduce"])},u(v.integral),3),e("div",ae,u(v.createTime),1)])]),_:1},8,["loading","dataSource"])]),_:1},8,["show","title","buttons"])}}};const se={class:"user-banner"},le=e("span",{class:"iconfont icon-right"},null,-1),ne=e("span",null,"个人中心",-1),re={class:"ucenter-panel"},ie={class:"user-side"},ce={class:"avatar-panel"},de={class:"avatar-inner"},ue={class:"nick-name"},_e={key:0,class:"iconfont icon-woman"},me={key:1,class:"iconfont icon-man"},ve={class:"desc"},fe={class:"user-extend-panel"},pe={class:"info-item"},ge=e("div",{class:"label iconfont icon-integral"},"积分",-1),he={key:1,class:"value"},Ie={class:"info-item"},we=e("div",{class:"label iconfont icon-like"},"获赞",-1),Ue={class:"value"},be={class:"info-item"},ye=e("div",{class:"label iconfont icon-post"},"发帖",-1),Re={class:"value"},ke={class:"info-item"},xe=e("div",{class:"label iconfont icon-register"},"加入",-1),Ce={class:"value"},De={class:"info-item"},Te=e("div",{class:"label iconfont icon-login"},"最后登录",-1),Ve={class:"value"},Ne={class:"article-panel"},Le={class:"article-list"},$e={__name:"Ucenter",setup(q){const{proxy:w}=E(),C=A(),b=$(),d=W(),_={getUserInfo:"/userCenter/getUserInfo",loadUserArticle:"/userCenter/loadUserArticle"},c=i(null),a=i({}),p=async()=>{let s=await w.Request({url:_.getUserInfo,params:{userId:c.value},errorCallback:()=>{setTimeout(()=>{C.push("/")},1500)}});s&&(a.value=s.data)},f=i(0),y=s=>{f.value=s,m()},r=i(!1),t=i({}),m=async()=>{r.value=!0;let s={pageNo:t.value.pageNo,type:f.value,userId:c.value},k=await w.Request({url:_.loadUserArticle,params:s,showLoading:!1});r.value=!1,k&&(t.value=k.data)},g=i(!1),U=()=>{const s=d.getters.getLoginUserInfo;s&&s.userId===c.value?g.value=!0:g.value=!1};L(()=>d.state.loginUserInfo,(s,k)=>{U()},{immediate:!0,deep:!0}),L(()=>b.params.userId,(s,k)=>{s&&(c.value=s,U(),p(),m())},{immediate:!0,deep:!0});const R=i(null),D=()=>{R.value.showEditUserInfoDialog(a.value)},v=s=>{a.value=s},T=i(null),h=()=>{T.value.showRecord()},B=i(!1);return L(()=>d.state.sysSetting,(s,k)=>{s&&(B.value=s.commentOpen)},{immediate:!0,deep:!0}),(s,k)=>{const z=l("router-link"),F=l("Avatar"),N=l("el-tab-pane"),H=l("el-tabs"),J=l("DataList");return I(),x("div",{class:"container-body ucenter",style:K({width:Y(w).globalInfo.bodyWidth+"px"})},[e("div",se,[o(z,{to:"/",class:"a-link"},{default:n(()=>[V("首页")]),_:1}),le,ne]),e("div",re,[e("div",ie,[e("div",ce,[g.value?(I(),x("div",{key:0,class:"edit-btn a-link",onClick:D}," 修改资料 ")):S("",!0),e("div",de,[o(F,{userId:a.value.userId,width:120},null,8,["userId"])]),e("div",ue,[e("span",null,u(a.value.nickName),1),a.value.sex==0?(I(),x("span",_e)):S("",!0),a.value.sex==1?(I(),x("span",me)):S("",!0)]),e("div",ve,u(a.value.personDescription),1)]),e("div",fe,[e("div",pe,[ge,g.value?(I(),x("div",{key:0,class:"value a-link",onClick:h},u(a.value.currentIntegral),1)):(I(),x("div",he,u(a.value.currentIntegral),1))]),e("div",Ie,[we,e("div",Ue,u(a.value.likeCount),1)]),e("div",be,[ye,e("div",Re,u(a.value.postCount),1)]),e("div",ke,[xe,e("div",Ce,u(a.value.joinTime),1)]),e("div",De,[Te,e("div",Ve,u(a.value.lastLoginTime),1)])])]),e("div",Ne,[o(H,{"model-value":f.value,onTabChange:y},{default:n(()=>[o(N,{label:"发帖",name:0}),o(N,{label:"评论",name:1}),o(N,{label:"点赞",name:2})]),_:1},8,["model-value"]),e("div",Le,[o(J,{loading:r.value,dataSource:t.value,onLoadData:m,noDataMsg:"暂无相关文章"},{default:n(({data:P})=>[o(G,{data:P,showEdit:f.value==0&&g.value,showComment:B.value},null,8,["data","showEdit","showComment"])]),_:1},8,["loading","dataSource"])])])]),o(X,{ref_key:"ucenterEditUserInfoRef",ref:R,onResetUserInfo:v},null,512),o(oe,{ref_key:"ucenterIntegralRecordRef",ref:T},null,512)],4)}}};export{$e as default};

import{q as L,s as I,G as R,y as V,x as t,Q as A,a as i,o as B,j as N,k as p,b as r,w as c,S as q,v as w,u as H,M as K}from"./.pnpm-d8f10c30.js";import{A as M}from"./ArticleListItem-83b88a0c.js";import"./_plugin-vue_export-helper-c27b6911.js";const z={class:"article-list"},O={__name:"Search",setup(E){const{proxy:f}=L();I(),R();const g=V(),k={loadArticle:"/forum/search"},S=(window.innerHeight-60-140-60)/2,v=t(!1),x=()=>{v.value=!0},a=t({}),y=t(),C={keyword:[{required:!0,message:"请输入关键字"},{min:3,message:"关键字太少，至少三个字"}]},d=t(!1),n=t({}),m=async()=>{y.value.validate(async o=>{if(!o)return;d.value=!0;let e={pageNo:n.value.pageNo,keyword:a.value.keyword},s=await f.Request({url:k.loadArticle,params:e,showLoading:!1});if(d.value=!1,!s)return;s.data.list.forEach(u=>{u.title=u.title.replace(e.keyword,"<span style='color:red'>"+e.keyword+"</span>")}),n.value=s.data})},b=()=>{a.value.keyword==""&&(n.value={})},_=t(!1);return A(()=>g.state.sysSetting,(o,e)=>{o&&(_.value=o.commentOpen)},{immediate:!0,deep:!0}),(o,e)=>{const s=i("el-input"),h=i("el-form-item"),u=i("el-form"),D=i("DataList");return B(),N("div",{class:"container-body search-body",style:w({width:H(f).globalInfo.bodyWidth+"px"})},[p("div",{class:"search-panel",style:w({"padding-top":v.value?"0px":S+"px"})},[r(u,{model:a.value,rules:C,ref_key:"formDataRef",ref:y,onSubmit:e[2]||(e[2]=q(()=>{},["prevent"]))},{default:c(()=>[r(h,{prop:"keyword"},{default:c(()=>[r(s,{size:"large",clearable:"",placeholder:"输入你想要查找的关键词",modelValue:a.value.keyword,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.keyword=l),onKeyup:K(m,["enter"]),onFocus:x,onChange:b},{suffix:c(()=>[p("span",{class:"iconfont icon-search",onClick:m,onBlur:e[0]||(e[0]=l=>a.value.keyword=l.target.value.trim())},null,32)]),_:1},8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model"])],4),p("div",z,[r(D,{loading:d.value,dataSource:n.value,onLoadData:m,noDataMsg:"没有发现帖子，赶紧发布一个吧"},{default:c(({data:l})=>[r(M,{data:l,showComment:_.value,htmlTitle:!0},null,8,["data","showComment"])]),_:1},8,["loading","dataSource"])])],4)}}};export{O as default};
